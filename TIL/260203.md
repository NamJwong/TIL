# 260203 화요일

## 아티클 <타입 시스템은 왜 증명처럼 동작하는가> 읽기

아티클-읽기/ 폴더에 기록

## 폼 필드의 빈 상태는 어떤 타입으로 표현하는 게 좋을까?

- null
  - 장점: '미입력' 상태를 타입으로 구분할 수 있음.
  - 단점: '미입력' 상태만이 아닌, '빈 상태'의 모든 케이스를 null로 관리한다면 input 컴포넌트 value <-> 폼 데이터 변환 시 매번 빈 문자열 체크 및 null 변환을 해주어야 함. (그러나 input 사용 시 빈 문자열 핸들링 로직은 숙명이다.)
- undefined
  - 장점: '미입력' 상태를 타입으로 구분할 수 있음. (그러나 아래 단점에도 있듯이, 필드가 옵셔널인 상태와 구분이 어려워 모호함이 있음.)
  - 단점
    - input 컴포넌트가 Uncontrolled 모드로 전환됨. (React 경고 발생)
    - 필드가 옵셔널인 상태와 구분이 어려움.
- 빈 문자열
  - 장점: 타입을 하나로 두고 단순하게 관리할 수 있음.
  - 단점: 빈 상태를 로직으로만 판별할 수 있음.

=> 일반적으로는 null로 관리하는 것이 좋겠다.
react-hook-form을 사용할 때에는

## 폼 필드의 빈 상태를 undefined로 관리하면 안되는 이유

### 궁금했던 배경

어떤 ~Field 컴포넌트에 아래와 같은 로직이 있었음.
폼 타입의 빈 상태를 어떤 타입으로 할지는 구현하는 입장의 자유라고 생각했기 때문에, 빈 상태를 undefined로 관리할 수 없는 아래 로직이 잘못됐다고 생각해 코드 작성하신 분께 문의를 했음.

```ts
const isControlled = value !== undefined;
```

하지만 이것이 일반적인 패턴이라 하셨고, 더불어 React의 기본 동작에 대한 언급을 해주셨음.
당시 이해를 정확히 못해서 찾아보게 됨.

### 설명

React의 `<input>`에는 두 가지 모드가 있습니다.

(input 뿐만이 아니라 모든 폼 관련 태그들. select, textarea, ...)

---

두 모드의 차이

```tsx
// ✅ Controlled: value를 지정 → React가 값을 관리
<input value={name} onChange={(e) => setName(e.target.value)} />

// Uncontrolled: value가 없음 → DOM(브라우저)이 값을 관리
<input onChange={(e) => console.log(e.target.value)} />
```

|              | Controlled    | Uncontrolled   |
| ------------ | ------------- | -------------- |
| 값 관리 주체 | React (state) | DOM (브라우저) |
| value prop   | 있음          | 없음           |

---

문제: value={undefined}는 "value 안 주는 것"과 동일

```tsx
// 이 세 가지는 React 눈에서 동일한 것
<input value={undefined} />
<input valaue={} /> // ← 빈 값
<input /> // ← value 아예 안 주기
```

undefined는 JS에서 "이 속성은 존재하지 않는다" 의 의미이기 때문입니다.

---

경고가 발생하는 상황

처음에 value가 있었던 (Controlled) 상태에서 undefined가 들어오면, 중간에
모드가 바뀌면서 React가 경고를 발생시킵니다.

```tsx
const [name, setName] = useState<string | undefined>(undefined);
// ↑ 초기값 undefined

<input
  value={name} // 처음: value={undefined} → Uncontrolled
  onChange={(e) => setName(e.target.value)} // 입력 후: value="hello" →
  Controlled
/>;
```

⚠️ Warning: A component is changing an uncontrolled input to be
controlled.
This is likely caused by the value changing from undefined to a defined
value,
which should not happen.

타임라인으로 보면:

초기 렌더 → value={undefined} → Uncontrolled 모드

사용자 입력 → value="hello" → Controlled 모드 ← 모드 전환! 경고!

### react-hook-form에서도 하지말라?

> You should avoid providing undefined as a default value, as it conflicts with the default state of a controlled component.

[defaultValues](https://react-hook-form.com/docs/useform#defaultValues) 설정 시 undefined 넣지 말라는 말인데 제대로 이해 못했는데 일단 기록

## react-hook-form: isDirty가 초기 렌더 후 true가 되는 경우

디버깅/react-hook-form-isDirty.md 에 작성
